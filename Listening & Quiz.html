<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Listening Comprehension — True/False Quiz</title>
<style>
  :root{
    --bg:#FDFBED;
    --ink:#222;
    --ink-soft:#4a4a4a;
    --accent:#8A0000;   /* red */
    --ok:#2F691C;       /* green */
    --card:#fff;
    --ring: rgba(138,0,0,.25);
    --gold:#D8b217;     /* yellow */
    --trueFill:#193873;
    --falseFill:#961917;
    --grey:#bdbdbd;
    --red:#B00020;
    --green:#2F691C;
    --muted:#e9e4cf;    /* for audio card border */
  }
  *{box-sizing:border-box}

  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family:"MS Reference Sans Serif", Arial, Helvetica, sans-serif;
    display:flex; align-items:center; justify-content:center; padding:16px;
    -webkit-tap-highlight-color: transparent;
  }

  .app{width:min(900px,100%); display:flex; flex-direction:column; gap:14px}

  header{display:flex; align-items:flex-start; justify-content:space-between; gap:12px; padding:8px 4px}
  h1{margin:0; font-weight:600; letter-spacing:.3px; line-height:1.2; color:#000; font-size:clamp(20px, 3.2vw, 28px)}
  .sub{color:var(--ink-soft); font-size:clamp(12px, 2.2vw, 14px); margin-top:2px}

  /* Question counter pill (used inline now) */
  .pill{
    padding:6px 10px; border-radius:999px; border:1px solid #e3d9d6; background:#fff; color:#333; font-size:13px;
  }
  .pill-inline{
    justify-self:center;
  }

  .card{background:var(--card); border:1px solid #e8e3df; border-radius:16px; box-shadow:0 6px 18px rgba(0,0,0,.06); padding:16px}
  .row{display:flex; align-items:center; justify-content:space-between; gap:12px}

  .progress{width:100%; height:10px; background:#eee; border-radius:999px; overflow:hidden; box-shadow:inset 0 0 0 1px #e5e5e5}
  .bar{height:100%; width:0%; background:var(--gold); transition:width .35s ease}

  .qwrap{display:grid; gap:12px; padding:10px 6px; text-align:center}
  .qtext{font-size:clamp(18px, 2.6vw, 28px); line-height:1.45; margin:28px 0}

  .btns{display:flex; justify-content:center; gap:12px; margin-top:4px; flex-wrap:wrap}

  button{
    appearance:none; border:2px solid transparent; color:#fff;
    padding:14px 18px; /* >=44px touch height */
    border-radius:20px; font-size:16px; cursor:pointer;
    transition:transform .05s ease, background-color .2s ease, color .2s ease;
    outline:none; min-width:148px; max-width:200px;
    touch-action: manipulation;
  }
  button:active{transform:translateY(1px)}

  .btnTrue{background:var(--trueFill)}
  .btnFalse{background:var(--falseFill)}

  /* Next / Restart buttons: grey border always, no glow */
  .btnAction{
    background:var(--gold); color:#000; border:2px solid var(--grey);
    box-shadow:none !important;
  }
  .btnAction:focus,
  .btnAction:active{border-color:var(--grey); box-shadow:none !important}

  /* Visible, neutral focus for keyboard users only */
  button:focus-visible{
    outline:2px solid #666;
    outline-offset:2px;
  }

  .btnRow{display:flex; gap:8px; flex-wrap:wrap}

  /* Feedback (live region) — height fixed per question to avoid layout shift */
  .feedback{
    margin-top:14px; font-size:16px;
    visibility:hidden; opacity:0; transition:opacity .3s ease;
    height:0; /* set dynamically before showing */
  }
  .feedback.show{visibility:visible; opacity:1}
  .feedback .correctWord{color:var(--green); font-weight:600}
  .feedback .incorrectWord{color:var(--red); font-weight:600}

  .footer{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:8px; color:#333; font-size:14px}
  .score{font-weight:600}

  /* End screen */
  .center{display:flex; align-items:center; justify-content:center; padding:16px}
  .big{text-align:center; padding:18px}
  .big h2{margin:.2rem 0 0; font-size:clamp(20px, 3vw, 26px)}
  .big p{margin:.25rem 0; color:#666}
  .scoreRing{width:110px; height:110px; border-radius:50%; display:grid; place-items:center; margin:6px auto 10px; border:6px solid var(--accent); color:#000; font-weight:700; font-size:20px; background:#fff}

  @media (max-width:540px){
    .footer{flex-direction:column; align-items:flex-start}
    /* Swap order of Restart and Next on mobile */
    .btnRow{width:100%; justify-content:stretch}
    #btnRestart{order:1}
    #btnNext{order:2}
    .btnRow > button{flex:1}
  }

  /* Ultra-narrow phones */
  @media (max-width:360px){
    button{min-width:120px}
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce){
    *{animation-duration:0.01ms !important; animation-iteration-count:1 !important; transition-duration:0.01ms !important;}
  }

  /* =======================
     Audio player (namespaced)
     ======================= */
  .audioCard{
    background:var(--card);
    border:1px solid var(--muted);
    border-radius:14px;
    box-shadow:0 2px 14px rgba(0,0,0,.06);
    padding:16px;
  }
  .audioHeader{margin:.2rem 0 .6rem; font-weight:600; font-size:clamp(16px,2.2vw,18px)}
  .ap-controls{display:flex; flex-direction:column; align-items:flex-start; gap:12px}
  .apbtn{
    appearance:none; border:none; cursor:pointer;
    padding:10px 14px; border-radius:999px;
    background:var(--accent); color:#fff; font-weight:600;
    transition:transform .06s ease, opacity .2s ease;
    display:inline-flex; align-items:center; gap:8px;
  }
  .apbtn:hover{opacity:.95}
  .apbtn:active{transform:scale(.98)}
  .apbtn.secondary{
    background:#0000; color:var(--accent);
    border:2px solid var(--accent);
  }
  .apbtn .icon{width:18px; height:18px; display:inline-block}

  .seekRow{width:100%}
  .timeRow{display:flex; justify-content:space-between; width:100%; font-size:.9rem; color:#444; margin-top:-2px}
  #seek{width:100%; height:6px; margin:2px 0 4px; background:transparent; accent-color:#000}
  input[type="range"]{ -webkit-appearance:none; background:transparent; }
  #seek::-webkit-slider-runnable-track{ height:6px; background:#000; border-radius:3px; }
  #seek::-moz-range-track{ height:6px; background:#000; border-radius:3px; }
  #seek::-webkit-slider-thumb{ -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:#000; margin-top:-4px; }
  #seek::-moz-range-thumb{ width:14px; height:14px; border-radius:50%; background:#000; border:none; }

  .volSubRow{ display:flex; justify-content:space-between; align-items:center; width:100% }
  #volRow{ display:flex; align-items:center; gap:8px }
  #volRow img{ width:20px; height:20px; display:block; user-select:none }
  #volSlider{ width:120px; height:4px; accent-color:#000; background:transparent }
  #volSlider::-webkit-slider-runnable-track{ height:4px; background:#000; border-radius:2px; }
  #volSlider::-webkit-slider-thumb{ -webkit-appearance:none; width:12px; height:12px; border-radius:50%; background:#000; margin-top:-4px; }
  #volSlider::-moz-range-track{ height:4px; background:#000; border-radius:2px; }
  #volSlider::-moz-range-thumb{ width:12px; height:12px; border-radius:50%; background:#000; border:none; }

  .status{margin-top:6px; font-size:.92rem; color:#444}
  .captions{ margin-top:12px; padding:12px; border:1px dashed var(--muted); border-radius:10px; min-height:3.25em; background:#fff }
  .captions[hidden]{display:none}
  .cap-line{line-height:1.35; font-size:1.05rem}
  .error{color:#B00020; font-weight:600}

  @media (max-width:520px){
    #volSlider{width:100px}
    .apbtn{padding:10px 12px}
  }
</style>
</head>
<body>
<main class="app">
  <header>
    <div>
      <h1>Listening Comprehension — True/False</h1>
      <div class="sub">A Surprise Meeting</div>
    </div>
  </header>

  <!-- Audio player card -->
  <section class="audioCard">
    <div class="audioHeader">Audio Player</div>
    <div id="player">
      <audio id="audio" preload="metadata"
        src="https://schredder222.github.io/Assets/Conversation%20-%20Tom%20&%20Anna2%20+%20crowd.mp3"></audio>

      <div class="ap-controls" role="group" aria-label="Audio controls">
        <button id="playPause" class="apbtn" aria-label="Play" aria-pressed="false">
          <span class="icon" aria-hidden="true">
            <!-- Play icon (triangle) -->
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
          </span>
          <span class="aplabel">Play</span>
        </button>

        <div class="seekRow" aria-label="Seek">
          <input id="seek" type="range" min="0" max="0" value="0" step="0.01" aria-label="Seek bar">
          <div class="timeRow">
            <span id="curTime" aria-label="Current time">0:00</span>
            <span id="durTime" aria-label="Duration">0:00</span>
          </div>
        </div>

        <div class="volSubRow">
          <div id="volRow" aria-label="Volume">
            <img src="https://schredder222.github.io/Assets/Unmute.svg" alt="Volume" />
            <input id="volSlider" type="range" min="0" max="1" step="0.01" value="1" aria-label="Volume slider" />
          </div>
          <button id="subsToggle" class="apbtn secondary" aria-pressed="true" aria-label="Toggle subtitles">Subtitles: On</button>
        </div>
      </div>

      <div class="status" id="status" aria-live="polite"></div>

      <div id="captionsBox" class="captions" aria-live="polite" aria-atomic="true">
        <div id="captionText" class="cap-line"></div>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="row"><div class="progress"><div class="bar" id="bar"></div></div></div>

    <!-- Question counter moved here (between bar and question text) -->
    <div class="qwrap" id="qwrap">
      <div class="pill pill-inline"><span id="qNum">1</span>/<span id="qTotal">10</span></div>

      <div class="qtext" id="qtext">Loading…</div>

      <div class="btns">
        <button class="btnTrue" id="btnTrue">True</button>
        <button class="btnFalse" id="btnFalse">False</button>
      </div>

      <div class="feedback" id="feedback" aria-live="polite" role="status"></div>

      <div class="footer">
        <div class="score">Score: <span id="score">0</span></div>
        <div class="btnRow">
          <button class="btnAction" id="btnNext">Next question</button>
          <button class="btnAction" id="btnRestart">Restart</button>
        </div>
      </div>
    </div>

    <div id="end" class="center" style="display:none">
      <div class="big">
        <div class="scoreRing" id="finalPct">0%</div>
        <h2 id="finalTitle">Nice work!</h2>
        <p id="finalMsg">You’ve completed the quiz.</p>
        <div style="margin-top:8px; display:flex; gap:8px; justify-content:center; flex-wrap:wrap">
          <button class="btnAction" id="btnRetry" style="min-width:148px">Restart quiz</button>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Applause (perfect only) -->
<audio id="applause" preload="auto" src="https://schredder222.github.io/Assets/Applause.mp3"></audio>

<script>
/* =====================
   AUDIO PLAYER SCRIPT
   ===================== */
(() => {
  const AUDIO_SRC  = "https://schredder222.github.io/Assets/Conversation%20-%20Tom%20&%20Anna2%20+%20crowd.mp3";
  const SRT_URL    = "https://schredder222.github.io/Assets/Conversation%20-%20Tom%20&%20Anna2.srt";
  const SUB_OFFSET = 2.7; // seconds delay

  const audio       = document.getElementById('audio');
  const playPause   = document.getElementById('playPause');
  const volSlider   = document.getElementById('volSlider');
  const subsToggle  = document.getElementById('subsToggle');
  const statusEl    = document.getElementById('status');
  const captionsBox = document.getElementById('captionsBox');
  const captionText = document.getElementById('captionText');
  const seek        = document.getElementById('seek');
  const curTimeEl   = document.getElementById('curTime');
  const durTimeEl   = document.getElementById('durTime');

  // SVG icons to ensure consistent appearance across desktop & mobile
  const ICONS = {
    play: '<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',
    pause:'<svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>'
  };
  const setBtn = (isPlaying) => {
    playPause.innerHTML = `<span class="icon" aria-hidden="true">${isPlaying?ICONS.pause:ICONS.play}</span><span class="aplabel">${isPlaying?'Pause':'Play'}</span>`;
    playPause.setAttribute('aria-label', isPlaying ? 'Pause' : 'Play');
  };

  let cues = [];
  let captionsOn = true;
  let lastIndex = -1;
  let isScrubbing = false;

  const fmtTime = (sec) => {
    if(!isFinite(sec) || sec < 0) sec = 0;
    const h = Math.floor(sec/3600);
    const m = Math.floor((sec%3600)/60);
    const s = Math.floor(sec%60);
    return h ? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
             : `${m}:${String(s).padStart(2,'0')}`;
  };

  function timeToSeconds(t){
    const m = t.trim().match(/(?:(\d+):)?(\d{2}):(\d{2})[.,](\d{3})/);
    if(!m) return 0;
    const h = +(m[1]||0), mi = +m[2], s = +m[3], ms = +m[4];
    return h*3600 + mi*60 + s + ms/1000;
  }
  function parseSRT(srt){
    return srt.replace(/\r/g,'').split(/\n\n+/).map(b=>{
      const lines=b.split('\n').filter(Boolean);
      if(lines.length<2) return null;
      if(/^\d+$/.test(lines[0])) lines.shift();
      const tm=lines.shift().match(/(\d{1,2}:\d{2}:\d{2}[.,]\d{3})\s*-->\s*(\d{1,2}:\d{2}:\d{2}[.,]\d{3})/);
      if(!tm) return null;
      return {start:timeToSeconds(tm[1]), end:timeToSeconds(tm[2]), text:lines.join(' ')};
    }).filter(Boolean);
  }
  function findCueIndex(arr, t){
    let lo=0, hi=arr.length-1;
    while(lo<=hi){
      const mid=(lo+hi)>>1, c=arr[mid];
      if(t < c.start) hi = mid-1;
      else if(t > c.end) lo = mid+1;
      else return mid;
    }
    return -1;
  }
  function setStatus(msg){ statusEl.textContent = msg; }

  playPause.addEventListener('click', () => {
    if(audio.paused){ audio.play(); }
    else{ audio.pause(); }
  });
  audio.addEventListener('play', ()=>{ setBtn(true); setStatus("Playing…"); });
  audio.addEventListener('pause',()=>{ setBtn(false); setStatus("Paused"); });
  audio.addEventListener('ended',()=>{ setBtn(false); setStatus("Finished"); });

  volSlider.addEventListener('input', e => audio.volume=+e.target.value);

  subsToggle.addEventListener('click', () => {
    captionsOn=!captionsOn;
    captionsBox.hidden=!captionsOn;
    subsToggle.textContent=captionsOn? "Subtitles: On" : "Subtitles: Off";
  });

  audio.addEventListener('loadedmetadata', () => {
    seek.max = audio.duration || 0;
    durTimeEl.textContent = fmtTime(audio.duration || 0);
    curTimeEl.textContent = fmtTime(0);
  });
  audio.addEventListener('timeupdate', () => {
    if(!isScrubbing){
      seek.value = audio.currentTime || 0;
      curTimeEl.textContent = fmtTime(audio.currentTime || 0);
    }
    if(cues.length && captionsOn){
      const t = audio.currentTime - SUB_OFFSET;
      const idx = (lastIndex !== -1 && t >= cues[lastIndex]?.start && t <= cues[lastIndex]?.end)
        ? lastIndex : findCueIndex(cues, t);
      if(idx !== lastIndex){
        lastIndex=idx;
        captionText.textContent= idx===-1? "" : cues[idx].text;
      }
    }
  });

  seek.addEventListener('input', () => { curTimeEl.textContent = fmtTime(+seek.value); });
  seek.addEventListener('mousedown', ()=>{ isScrubbing=true; });
  seek.addEventListener('mouseup', ()=>{ isScrubbing=false; audio.currentTime=+seek.value; });

  async function init(){
    try{
      setBtn(false);
      audio.src = AUDIO_SRC;
      const res = await fetch(SRT_URL);
      const srt = await res.text();
      cues = parseSRT(srt);
    }catch(e){
      captionText.textContent="(Subtitles unavailable)";
    }
  }
  init();
})();
</script>

<script>
/* =====================
   QUIZ SCRIPT
   ===================== */
(() => {
  const sfxClick = new Audio('https://cdn.pixabay.com/download/audio/2024/04/21/audio_1b8d3bcd3d.mp3?filename=click-buttons-ui-menu-sounds-effects-button-7-203601.mp3');
  const sfxCorrect = new Audio('https://cdn.pixabay.com/download/audio/2022/03/24/audio_dcde83efa6.mp3');
  const sfxWrong = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_b0669294aa.mp3');
  function playSfx(a){ try { a.currentTime=0; a.play(); } catch(e){} }

  const applause = document.getElementById("applause");

  const ITEMS = [
    {s:'Anna and Tom see each other regularly.',a:false,e:'Anna says “I haven’t seen you in ages.”'},
    {s:'Both Anna and Tom are students at the university.',a:false,e:'Tom works at the university, Anna studies there.'},
    {s:'Tom has worked at the university for 2 years (in 2025).',a:true,e:'He has worked there since 2023.'},
    {s:'Both Anna and Tom think the city is very fast-paced.',a:true,e:'They both describe the city as busy/chaotic.'},
    {s:'Anna is having trouble finding interesting things to do.',a:false,e:'She has found lots of cafés, museums and galleries.'},
    {s:'Tom has had a busy life since he moved to the city.',a:true,e:'He says “It’s been very busy.”'},
    {s:'Tom found some good friends in the past, but not anymore.',a:false,e:'He continues to make and keep friends.'},
    {s:'Anna wants to meet at 12pm because she’s worried about traffic.',a:true,e:'She wants to avoid commuting during rush hour.'},
    {s:'Anna and Tom organise a time to meet next week.',a:false,e:'Tom says he will text her next week to organise.'},
    {s:'Only Anna wants to meet.',a:false,e:'Both say they would like to meet.'}
  ];

  let idx=0,score=0,answered=false;
  const qNum=document.getElementById('qNum');
  const qTotal=document.getElementById('qTotal');
  const qtext=document.getElementById('qtext');
  const bar=document.getElementById('bar');
  const feedback=document.getElementById('feedback');
  const btnTrue=document.getElementById('btnTrue');
  const btnFalse=document.getElementById('btnFalse');
  const btnNext=document.getElementById('btnNext');
  const btnRestart=document.getElementById('btnRestart');
  const end=document.getElementById('end');
  const qwrap=document.getElementById('qwrap');
  const scoreEl=document.getElementById('score');
  const finalPct=document.getElementById('finalPct');
  const finalTitle=document.getElementById('finalTitle');
  const finalMsg=document.getElementById('finalMsg');
  const btnRetry=document.getElementById('btnRetry');
  const qTotalVal=ITEMS.length;
  qTotal.textContent=qTotalVal;

  function setBar(){bar.style.width=(idx/ITEMS.length*100)+'%';}

  /** Measure & reserve feedback height BEFORE showing (all screens). */
  function reserveFeedbackSpace(item){
    const probe = document.createElement('div');
    probe.className = 'feedback show';
    probe.style.position = 'absolute';
    probe.style.visibility = 'hidden';
    probe.style.pointerEvents = 'none';
    const w = feedback.clientWidth || feedback.offsetWidth || 300;
    probe.style.width = w + 'px';
    probe.innerHTML = `<span class="correctWord">Correct</span> — ${item.e}`;
    document.body.appendChild(probe);
    const h1 = probe.scrollHeight;
    probe.innerHTML = `<span class="incorrectWord">Incorrect</span> — ${item.e}`;
    const h2 = probe.scrollHeight;
    document.body.removeChild(probe);
    const h = Math.max(h1, h2);
    feedback.style.height = h + 'px';
  }

  function resetButtons(){
    btnTrue.style.borderColor='transparent';
    btnFalse.style.borderColor='transparent';
    btnTrue.style.borderWidth='2px';
    btnFalse.style.borderWidth='2px';
  }

  function render(){
    const item=ITEMS[idx];
    qNum.textContent=(idx+1);
    qtext.textContent=item.s;

    feedback.className='feedback';
    feedback.innerHTML='';
    reserveFeedbackSpace(item);

    btnTrue.disabled=false; btnFalse.disabled=false;
    resetButtons();
    answered=false;

    btnNext.textContent = (idx === ITEMS.length-1) ? "Finish" : "Next question";
  }

  function start(){
    idx=0; score=0; answered=false;
    scoreEl.textContent=score;
    qwrap.style.display=''; end.style.display='none';
    resetButtons();
    setBar(); render();
  }

  function answer(val){
    if(answered) return;
    const item=ITEMS[idx];
    const correct=(val===item.a);
    answered=true;
    if(correct) score++;
    scoreEl.textContent=score;

    feedback.className='feedback show';
    feedback.innerHTML=`<span class="${correct?'correctWord':'incorrectWord'}">${correct?'Correct':'Incorrect'}</span> — ${item.e}`;

    btnTrue.disabled=true; btnFalse.disabled=true;

    const GREEN = getComputedStyle(document.documentElement).getPropertyValue('--ok').trim() || '#2F691C';
    if(item.a === true){
      btnTrue.style.borderColor = GREEN;
      btnTrue.style.borderWidth = '3px';
    }else{
      btnFalse.style.borderColor = GREEN;
      btnFalse.style.borderWidth = '3px';
    }

    playSfx(sfxCorrect && sfxWrong ? (correct ? sfxCorrect : sfxWrong) : null);
  }

  function next(){
    if(idx<ITEMS.length-1){ idx++; setBar(); render(); }
    else finish();
  }

  function finish(){
    qwrap.style.display='none'; end.style.display='';
    const pct=Math.round(score/ITEMS.length*100);
    finalPct.textContent=pct+'%';

    // Ring: <6 red, 6–8 yellow, 9–10 green
    if(score <= 5){
      finalPct.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim() || '#8A0000';
    }else if(score <= 8){
      finalPct.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--gold').trim() || '#D8b217';
    }else{
      finalPct.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--ok').trim() || '#2F691C';
    }

    finalTitle.textContent = (score === 10) ? 'Amazing!' : (score >= 7 ? 'Not bad!' : 'Keep practising!');
    finalMsg.textContent = `You scored ${score} out of ${ITEMS.length}.`;
    btnRetry.textContent = (score === 10) ? "Restart quiz" : "Try again!";

    bar.style.width='100%';

    // Perfect score: applause only
    if(score === 10){
      try{ applause.currentTime=0; applause.play(); }catch(e){}
    }
  }

  // Events
  document.getElementById('btnTrue').onclick=()=>answer(true);
  document.getElementById('btnFalse').onclick=()=>answer(false);
  document.getElementById('btnNext').onclick=()=>{ playSfx(sfxClick); next(); };
  document.getElementById('btnRestart').onclick=()=>{ playSfx(sfxClick); start(); };
  document.getElementById('btnRetry').onclick=()=>{ playSfx(sfxClick); start(); };

  // Keyboard shortcuts (desktop convenience)
  window.addEventListener('keydown',e=>{
    const k=e.key.toLowerCase();
    if(end.style.display==='none'){
      if(k==='t') answer(true);
      else if(k==='f') answer(false);
      else if(k==='enter'){ playSfx(sfxClick); next(); }
    }else{
      if(k==='enter'){ playSfx(sfxClick); start(); }
    }
  });

  start();
})();
</script>
</body>
</html>
